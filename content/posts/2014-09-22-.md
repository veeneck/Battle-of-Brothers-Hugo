---
title: How To Implement Squads and Formations, Part 2
author: Ryan
type: post
date: -001-11-30T00:00:00+00:00
draft: true
url: /?p=1300
categories:
  - sirryan
tags:
  - code
  - learning
  - sprite kit

---
This is a continuation of my attempts to implement coordinated squad movement. For this tutorial, I&#8217;ll be addressing wheeling, or turning a group of soldiers based on a specific pivot point.

<!--more-->

  * <a href="http://battleofbrothers.com/sirryan/how-to-implement-squads-and-formations-part-1" target="_blank">Part 1: Getting Into Formation</a>
  * Part 2: Wheeling

#### Rotating From Center

<div class="inlineimg">
  <img class="alignnone wp-image-1304 size-full" src="http://localhost:8888/wp-content/uploads/2014/09/ccob2.gif" alt="" width="360" height="202" />
</div>

Wheeling around the center point is very similar to the <a href="https://gist.github.com/veeneck/887215255fbaf954eddc" target="_blank">moveIntoFormation()</a> function we used in the last tutorial. The only real difference is that the code has to be executed during each game loop until the desired angle is reached. To handle that, we&#8217;ll have a look at the `wheel()` function that will be called each iteration.

https://gist.github.com/veeneck/6c65a168e058863619a5

There are two specifics points to note before proceeding.

  * I&#8217;ve added a variable named `heading` onto our `Formation` class. This is a `CGFloat` that will track the direction the formation is facing. It can be used when the group reforms after breaking apart, or when calculating the angles for wheeling.
  * Right now, the code has the &#8220;speed&#8221; hard coded as -0.003, which means the unit will rotate -0.003 radians every frame of the game. This means we can only wheel in one direction. This will be addressed later.

Next up, let&#8217;s call the wheel function once every game update. To do that, add some sort of update method into the `Squad` class that gets called from the main scene. Mine looks like this:

https://gist.github.com/veeneck/23e3050b004a7f16f241

Simple enough. The only future considerations would be to move this logic into a state machine, but for now we&#8217;re in a good spot.

#### Wheeling Off of a Specific Soldier

Wheeling off of the center of the unit works, but it is more realistic for the formation to pivot off of a specific soldier. For example, turning off of the front-right soldier if the formation needs to face the right.

<div class="inlineimg">
  <img class="alignnone wp-image-1314 size-full" src="http://localhost:8888/wp-content/uploads/2014/09/ccwqo-1.gif" alt="" width="360" height="202" />
</div>

To rotate around a point other than the center, we have to translate our matrix to the new center (also new point of rotation). The process goes like this:

  * Determine point to rotate around.
  * Translate matrix to new point.
  * Perform rotation.
  * Translate matrix back to old center.

You can find more information on the topic by reading <a href="http://math.stackexchange.com/a/62248" target="_blank">this StackExchange topic</a> or through [2d transformations][1]. Or, see how to modifications would look in our code:

https://gist.github.com/veeneck/aae205fe33a015e866f2

It&#8217;s a simple adjustment to change the point of rotation. Also, notice the addition of the `translateX` and `translateY` variables. Those are just member variables I set in the `wheelToAngle()` function. The caller can pass in the desired angle, and the desired rotation center.

#### Speed and Direction

Mentioned a couple of things to address later.

#### Further Polish

A few things to address based on your type of game:

  * Have units face the appropriate direction throughout the entire rotation.
  * Have the unit that we&#8217;re wheeling off of stand still, instead of walking in place.

 [1]: http://processing.org/tutorials/transform2d/