

	


<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
	<title>Battle of Brothers | A Video Game Programming Duel</title>
	<meta name="description" content="Follow Chris and Ryan as they design indie video game software using the Corona SDK and Sprite Kit frameworks in this game programming duel.">
	<meta name="keywords" content=“video,game,programming,software, design, corona, sprite kit, indie”>
	<meta name="author" content="Battle of Brothers">
	<meta name="robots" content="index, follow">
	<meta name="viewport" content="width=1024"/>

  


   	 <link rel="stylesheet" href="/css/ryan.css?v=1'; ?>" type="text/css" media="screen" />
    <link rel="stylesheet" href="/css/global.css" type="text/css" media="screen" />





  <link rel="stylesheet" href="/css/post.css?v=1'; ?>" type="text/css" media="screen" />


<script src="/js/index-min.js"></script>

  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18183842-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18183842-5');
</script>
</head>
  <body class="home gradient">

    

  	

<div class="top">
	<div class="breadcrumb">
		<p>Currently following
		
		<a href="/sirryan" title="Hurrah!" class="dotted">Sir Ryan</a></p> 
		<p><a href="/sirchris" title="To see what the losing team is up to." class="switch chris">See what Sir Chris is up to &#8611;</a></p>
		
	</div>
</div>



  	


	


<header class="content">
	<a class="ryanshield rotate " href="/sirryan">
		<img class="" style="" src="/assets/RyanShield.png" />
	</a>

	
	<a class="mainshield" href="/">
		<img alt="The one year game develpoment duel" src="/assets/Banner.png" width="266px" class="" />
	</a>
	

	<a class="chrisshield counterrotate" href="/sirchris">
		<img style="" src="/assets/ChrisShield.png" />
	</a>

</header> 

  	
<nav>
	
		<div class="navcontainer clear blog">
	
  		<div class="clear navbox leftnav">
  			<span>
	  			<a href="/sirryan" class="blog clear">
	  				<img class="" src="/assets/Castle.png" width="16px" />Sir Ryan
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/timeline" class="timeline clear">
	  				<img class="" src="/assets/Boom.png" width="16px"  />Timeline
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/budget" class="budget clear">
	  				<img class="" src="/assets/Money-5.png" width="16px"  />Budget
	  			</a>
  			</span>
		</div>
		<div class="clear navbox">
			<span>
	  			<a href="/sirryan/contact" class="contact clear">
	  				<img class="" src="/assets/Game-Controller.png" width="16px"  />Contact
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/subscribe" class="subscribe clear">
	  				<img class="" src="/assets/RSS.png" width="16px"  />Subscribe
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/about" class="about clear">
	  				<img class="" src="/assets/Pacman-2.png" width="16px"  />About
	  			</a>
  			</span>
		</div>
	</div>
</nav>


    <div class="outercontent">
  	  <div class="content clear">

		<article class="clear">
			<div class="title clear">
				
<div class="floatleft timestamp">
	<span class="month">Jun</span>
	<p class="shield" style="background-image:url('/assets/Shield7.png')">18</p>
	<span class="year legacy">2014</span>
</div>
				<h3 class="grace">Challenges You May Encounter While Porting Your SpriteKit Game to Swift</h3>
				<div class="subhead">
					



	
	
		
	


<span class="comments floatright">
	<img class="icon" src="/assets/Chat-6.png" width="16px" />
	<small><a href="/sirryan/challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift/#comments" class="dotted"><span></span>1 comment</a></small>
</span>
<img class="icon" src="/assets/Tag-star.png" width="16px">
<small>
	
	<a href="/sirryan/tags/code" class="dotted">code</a>
	
	<a href="/sirryan/tags/learning" class="dotted">learning</a>
	
	<a href="/sirryan/tags/sprite%20kit" class="dotted">sprite kit</a>
	
	<a href="/sirryan/tags/swift" class="dotted">swift</a>
	
</small>
				</div>
			</div>

			

			
				
			
				
			
				
			
				
			

			<div class="post source_light">		
				
 				<p>The introduction of <a href="https://developer.apple.com/swift/">Swift</a> comes at a perfect time for me. I’ve been working on a SpriteKit game in Objective-C for 10 weeks now, and some of the code is definitely in need of refactoring. Refactoring is known to be tedious, so being able to learn a new language during the process is a plus. I’ve been taking notes of any challenge I’ve come across during the conversion.
</p>

<h4 id="preloading-assets">Preloading Assets</h4>

<p>Apple&#8217;s own adventure game <a href="https://developer.apple.com/library/mac/documentation/GraphicsAnimation/Conceptual/CodeExplainedAdventure/BuildingtheWorld/BuildingtheWorld.html#//apple_ref/doc/uid/TP40013140-CH3-SW2" target="_blank">loads assets asynchronously</a> while showing a loading screen. I used a similar setup in my game, so went ahead and changed it over. In your <code>ViewController</code>, wrap the loading of the scene into a callback function.</p>

<p>Notice the call to <code>loadSceneAssetsWithCompletionHandler</code> &#8212; we&#8217;ll have to implement that function on our scene (<code>Foothills.swift</code> in my case).</p>

<p>The odd part to me was the syntax for the callback function. Aside from that, the setup is similar to its Objective-C counterpart.</p>

<h4 id="static-variables-in-a-class">Static Variables in a Class</h4>

<p>While the previous section, Preloading Assets, handles the setup code to show a loading screen, we still have actually have to store the loaded textures somewhere. In the example above, notice the call to <code>MySprite.loadSharedAssets()</code>. In Objective-C, a method like this would usually load data into a static class variable. It appears static variables are only allowed in enums or structs in Swift, which leads to this code that populates an array of textures to be shared across each instance of the class:</p>

<p>Keep an eye on <a href="http://stackoverflow.com/questions/24024549/dispatch-once-singleton-model-in-swift" target="_blank">this Stack Overflow thread</a> because the preferred solution to this problem appears to be changing as developers learn more.</p>

<h4 id="closures">Closures</h4>

<p><a href="https://developer.apple.com/library/prerelease/ios/documentation/swift/conceptual/swift_programming_language/Closures.html" target="_blank">Closures</a> can be as simple as <code>{ // your code }</code> when passing a parameter. The interesting part is with the function definition. Have a look at this code:</p>

<p><a href="https://gist.github.com/a3b35bbc51f0f82c5afb">https://gist.github.com/a3b35bbc51f0f82c5afb</a></p>

<p>If you’re like me, the syntax will be foreign. The parameter definition states that a closure with no parameters and no return value should be passed in. But what happens when we want a closure to accept parameters? The syntax changes to <code>{ (param1, param2) in }</code>. For example, let’s look at <code>enumerateChildNodesWithName</code>:</p>

<p><a href="https://gist.github.com/f95625ecc77bced84caf">https://gist.github.com/f95625ecc77bced84caf</a></p>

<p>And thanks to this <a href="http://stackoverflow.com/questions/24213436/how-to-use-enumeratechildnodeswithname-with-swift-in-spritekit" target="_blank">Stack Overflow post</a>, the code can be simplified even more:</p>

<p><a href="https://gist.github.com/af6f2525af76f13c513c">https://gist.github.com/af6f2525af76f13c513c</a></p>

<p>I did find a thorough read of Swift&#8217;s <a href="https://developer.apple.com/library/prerelease/ios/documentation/swift/conceptual/swift_programming_language/Closures.html#//apple_ref/doc/uid/TP40014097-CH11-XID_117" target="_blank">Closure Documentation</a> to be helpful once I understood the basic concepts.</p>

<h4 id="casting">Casting</h4>

<p>In the example above, the first parameter of the closure is of the type <code>SKNode</code>. How would we change the code if we know what type of object will be returned?</p>

<p>We can use the <code>as</code> keyword to cast to a subclass of <code>SKNode</code>. The annoying part here is the addition of an extra line of code. I thought it would be nice if we could cast directly in the parameter definition, but it turns out <a href="http://stackoverflow.com/questions/24272642/cast-callback-parameter-in-swift" target="_blank">down casting in a closure is not possible</a> &#8212; you can only upcast.</p>

<h4 id="plist-files-and-data-types">pList Files and Data Types</h4>

<p>An extension of my problems with casting can be found when working with pList files. In the example below, we’ll load a pList file with an array of dictionaries.</p>

<p><a href="https://gist.github.com/f0c0753cde8fc7ddd4c2">https://gist.github.com/f0c0753cde8fc7ddd4c2</a></p>

<p>Notice that the array is cast as a <code>NSArray</code> (line 3 above). If you try to cast it to a Swift Array object without knowing the types of data contained within,  you will get this error:</p>

<blockquote>
<p>Cannot convert the expression&#8217;s type &#8216;Array&lt;$T7&gt;&#8217; to type &#8216;$T8&#8217;</p>
</blockquote>

<p>In Swift, each collection should have the same data type contained inside. Since that’s what we have at the Dictionary level (line 4 above), we can do a direct conversion to a Swift friendly object:</p>

<pre><code>Dictionary&lt;String,String&gt;[]
</code></pre>

<p>This will create a Swift Dictionary that has keys and values that are Strings. Once we’re working with a Swift object, all loops and other features will behave as expected. In some cases, you will have to loop over pList data that does not have the same data type for each element. In those cases, the loop may look like this:</p>

<p><a href="https://gist.github.com/c5732e746a5f55c9f42e">https://gist.github.com/c5732e746a5f55c9f42e</a></p>

<p>Notice that the item is set to <code>NSDictionary</code> instead of <code>Dictionary</code>, but we can still access the data inside with the shorthand syntax.</p>

<h4 id="subclass-initializers">Subclass &amp; Initializers</h4>

<p>When subclassing an object like SKSpriteNode, you may encounter this error at runtime even though the build succeeds:</p>

<blockquote>
<p>fatal error: use of unimplemented initializer &#8216;init(texture:color:size:)&#8217; for class</p>
</blockquote>

<p>The reason for this error is that Swift <a href="http://www.codeproject.com/Articles/783584/Subclassing-Objective-C-classes-in-Swift-and-the-p" target="_blank">does not inherit initializers from a parent class</a> by default. One way to solve this is to define each initializer. For example, extending <code>SKSpriteNode</code> could result in:</p>

<p>An alternate solution is to call the initializer that we know will definitely be used:</p>

<p>This is nice because we don&#8217;t have to define each initializer, but it is still frustrating to have to call the verbose <code>init</code> that requires all parameters.</p>

<p>From the Swift Docs &#8211; <a href="https://developer.apple.com/library/prerelease/ios/documentation/swift/conceptual/swift_programming_language/Initialization.html#//apple_ref/doc/uid/TP40014097-CH18-XID_284" target="_blank">Class Inheritance and Initialization</a></p>

<h4 id="more-reading">More Reading</h4>

<p>A few problems or noteworthy items that other developers have encountered:</p>

<ul>
<li><a href="https://medium.com/swift-programming/swift-gotchas-cfe0182a58af" target="_blank">Swift Gotchas</a></li>
<li><a href="https://medium.com/swift-programming/initial-trip-ups-with-swift-cc111b6ef012" target="_blank">Initial Trip-Ups With Swift</a></li>
<li><a href="https://blog.codecentric.de/en/2014/06/10-early-thoughts-swift-programming-language/" target="_blank">10 Early Thoughts on the Swift Programming Language</a></li>
<li><a href="https://blog.codecentric.de/en/2014/06/10-early-thoughts-swift-programming-language/" target="_blank">Thoughts on the Swift Language</a></li>
<li><a href="http://graydon2.dreamwidth.org/5785.html" target="_blank">Swift (From Rust designer)</a></li>
<li><a href="http://www.evanmiller.org/swift-impressions.html">Swift Impressions</a></li>
</ul>
			</div>

		</article>

	</div>
</div>

<div class="outercontentalt">
  	<div class="content clear">

  		<div id="discuss" class="discuss">
			<img class="" src="/assets/discuss.png" />
		</div>

	  
	  
	  
	  	
	  	
		    <h5 class="grace comment-count"><span class="legacy">1</span> of you did not hold your tongue!</h5>
			<ol id="comments" class="commentlist">
		  		
		    		

		    			


<li >
	<div class="comment-body">
		<div class="comment-author vcard">
			<img src="https://www.gravatar.com/avatar/?s=118&d=http://battleofbrothers.com/assets/comment_av_9.png" alt="" class="avatar avatar-64 photo" height="118" width="118">
		</div>
		<div class="comment-wrapper">
			
				<p>[&amp;#8230;] the last 8 days or so of the 4 weeks, I made some real progress. My port to Swift wasn&amp;#8217;t without challenges, but now I&amp;#8217;m about a week away from where I was with my Objective-C code. Moral has been low [&amp;#8230;]</p>
			
		</div>
		<div class="comment-meta commentmetadata">
			<a href="#">#</a> by 
			<cite class="fn">
				
				    Battle of Brothers | A Video Game Programming Duel
				
			</cite> Jul 7, 2014
		</div>
		<div class="reply">
			<a id="527" class="btn-info comment-reply-link" href="#comment-form" onclick="changeValue('fields[reply_to]', '527')">Reply</a>
		</div>
	</div>
</li>

<ul class="children">

  

</ul> 

		    		
		  		     
		  	</ol>  
		 

		 <hr />
	  
 
	  <div class="comment-form">
  <div id="respond" class="comment-respond">
    <h3 id="reply-title" class="comment-reply-title">Speak Freely <small></h3>     

    <form class="comment-form" method="POST" action="https://api.staticman.net/v2/entry/veeneck/Battle-of-Brothers-Hugo/master/comments">
        <p class="comment-notes">
          <span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span>
        </p>
          <p class="comment-form-comment">
            <label for="comment">Comment</label> 
            <textarea id="comment" name="fields[body]" class="post-comment-field" placeholder="Your message. Feel free to use Markdown." cols="45" rows="8" maxlength="65525" required="required"></textarea>
          </p>
          <p class="comment-form-author">
            <label for="author">Name <span class="required">*</span></label> 
            <input id="author" name="fields[name]" type="text" class="post-comment-field" placeholder="Your name" required="required" size="30" maxlength="245">
          </p>
          <p class="comment-form-email">
            <label for="email">Email</label> 
            <input id="email" name="fields[email]" type="email" class="post-comment-field" placeholder="Your email address" ize="30" maxlength="100">
          </p>
          <p class="comment-form-url">
            <label for="website">Website</label> 
            <input id="website" name="fields[website]" type="url" class="post-comment-field" placeholder="http://yoursite.com" ize="30" maxlength="200">
          </p>
          <p class="form-submit">
            <input type="submit" id="submit" class="post-comment-field btn submit" value="Submit" id="submit_button" value="Post Comment">
            <input type="hidden" name="options[redirect]" value="http://battleofbrothers.com/sirryan/challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift/#post-submitted">
            <input type="hidden" name="options[redirectError]" value="http://battleofbrothers.com/sirryan/challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift/#post-error">
            <input type="hidden" name="options[entryId]" value="2014-06-18-challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift">
            <input type="hidden" name="options[slug]" value="http://battleofbrothers.com/sirryan/challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift/">
            <input type="hidden" name="options[origin]" value="http://battleofbrothers.com/sirryan/challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift/">
            <input type="hidden" name="options[parent]" value="2014-06-18-challenges-you-may-encounter-while-porting-your-spritekit-game-to-swift">
            <input type="hidden" name="fields[reply_to]" value="">
          </p>      
      </form>
    </div>

    <div id="post-submitted">
      <hr style="margin-bottom: 50px;" />
      <h3 class="comment-reply-title">Thank you</h3>
        <p>Your comment will be published once it has been approved.</p>
        <p><a class="comment-reply-link" href="https://github.com/veeneck/Battle-of-Brothers-Hugo/pulls">Click here</a> to see the pull request you generated.</p>
    </div>
</div>
     </div>
</div> 

    
    <footer class="clear">

  	<div class="bob">
  		<img src="/assets/battleofbrothers.png" />
  	</div>

  	<div >
		<div class="footer_content">
		  	<div class="corner cell">
		  		<p>&nbsp</p>
	  			<img class="ryanfoot" src="/assets/RyanShieldLarge.png" />
	  		</div>
	  		<div class="footerflex">
				<div class="about_contest cell">
					<div class="inner">
						<h5>$25,000. 2 brothers. 1 year. 0 experience.</h5>
						<p>Armed with little to no game development experience, we're setting out to see who can make the best game. 
						In the spirit of learning and following a passion, we're each going to take one year and a $25,000 budget to see how far we can get. 
						It begins on April 7th, 2014. We'll be documenting the journey.</p>
						<p><a href="/">Learn More!</a></p>
					</div>
				</div>
				<div class="links cell">
					<div class="outer">
						<h5>Sir Ryan</h5>
						<p>
							<a class="ryan" href="/sirryan/">Blog</a> /&nbsp; 
							<a class="ryan" href="/sirryan/budget">Budget</a> /&nbsp; 
							<a class="ryan" href="/sirryan/timeline">Timeline</a><span class="social">C</span>
							<a class="white" href="https://twitter.com/veeneck">@veeneck</a></br>
							<a class="ryan" href="/sirryan/contact">Contact</a> /&nbsp; 
							<a class="ryan" href="/sirryan/about">About</a> /&nbsp; 
							<a class="ryan" href="/category/sirryan">Archive</a>
							<span class="social rss">V</span><a class="white" href="http://feeds.feedburner.com/BattleOfBrothers">RSS Feed</a></br>
						</p>
						<h5>Sir Chris</h5>
						<p>
						<a class="chris" href="/sirchris/">Blog</a> /&nbsp; 
						<a class="chris" href="/sirchris/budget">Budget</a> /&nbsp; 
						<a class="chris" href="/sirchris/timeline">Timeline</a>
						<span class="social">C</span><a class="white" href="https://twitter.com/codepaladin">@codepaladin</a></br>
						<a class="chris" href="/sirchris/contact">Contact</a> /&nbsp; 
						<a class="chris" href="/sirchris/about">About</a> /&nbsp; 
						<a class="chris" href="/category/sirchris">Archive</a><span class="social rss">V</span>
						<a class="white" href="http://feeds.feedburner.com/BattleOfBrothers">RSS Feed</a></br></p>
					</div>
				</div>
			</div>
			<div class="corner cell">
				<p>&nbsp</p>
				<img class="chrisfoot" src="/assets/ChrisShieldLarge.png" />
			</div>
		</div>
	</div>
</footer>
  </body>
</html>