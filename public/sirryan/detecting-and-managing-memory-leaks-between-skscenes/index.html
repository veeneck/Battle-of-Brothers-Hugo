

	


<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
	<title>Battle of Brothers | A Video Game Programming Duel</title>
	<meta name="description" content="Follow Chris and Ryan as they design indie video game software using the Corona SDK and Sprite Kit frameworks in this game programming duel.">
	<meta name="keywords" content=“video,game,programming,software, design, corona, sprite kit, indie”>
	<meta name="author" content="Battle of Brothers">
	<meta name="robots" content="index, follow">
	<meta name="viewport" content="width=1024"/>

  


   	 <link rel="stylesheet" href="/css/ryan.css?v=1'; ?>" type="text/css" media="screen" />
    <link rel="stylesheet" href="/css/global.css" type="text/css" media="screen" />





  <link rel="stylesheet" href="/css/post.css?v=1'; ?>" type="text/css" media="screen" />


  
</head>
  <body class="home gradient">

  	<div id="leftChecker"></div>

  	

<div class="top">
	<p class="breadcrumb">
		Currently following
		
		<a href="/sirryan" title="Hurrah!" class="dotted">Sir Ryan</a> 
		<a href="/sirchris" title="To see what the losing team is up to." class="switch floatright sirchris">See what Sir Chris is up to &#8611;</a>
		
	</p>
</div>



  	


	


<header class="content">
	<a class="ryanshield rotate " href="/sirryan">
		<img class="" style="" src="/assets/RyanShield.png" />
	</a>

	
	<a class="mainshield" href="/">
		<img alt="The one year game develpoment duel" src="/assets/Banner.png" width="266px" class="" />
	</a>
	

	<a class="chrisshield counterrotate" href="/sirchris">
		<img style="" src="/assets/ChrisShield.png" />
	</a>

</header> 

  	
<nav>
	
		<div class="container clear blog">
	
  		<div class="leftnav clear">
  			<span>
	  			<a href="/sirryan" class="blog clear">
	  				<img class="" src="/assets/Castle.png" width="16px" />Sir Ryan
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/timeline" class="timeline clear">
	  				<img class="" src="/assets/Boom.png" width="16px"  />Timeline
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/budget" class="budget clear">
	  				<img class="" src="/assets/Money-5.png" width="16px"  />Budget
	  			</a>
  			</span>
		</div>
		<div class="rightnav clear">
			<span>
	  			<a href="/sirryan/contact" class="contact clear">
	  				<img class="" src="/assets/Game-Controller.png" width="16px"  />Contact
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/subscribe" class="subscribe clear">
	  				<img class="" src="/assets/RSS.png" width="16px"  />Subscribe
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/about" class="about clear">
	  				<img class="" src="/assets/Pacman-2.png" width="16px"  />About
	  			</a>
  			</span>
		</div>
	</div>
</nav>


    

	<div class="outercontent">
  	  <div class="content clear">

		<article class="clear">
			<div class="title clear">
				<div class="floatleft">
					<span class="month legacy">Jan</span> 
					<p class="shield legacy" style="background-image:url('/assets/Shield11.png')">8</p>
					<span class="year legacy">2016</span> 
				</div>
				<h3 class="grace">Detecting and Managing Memory Leaks Between SKScenes</h3>
				<div class="subhead">
					<span class="comments floatright">
						<img class="icon" src="/assets/Chat-6.png" width="16px" />
						<small><a href="/" class="dotted">X Comments</a></small>
					</span>
					<img class="icon" src="/assets/Tag-star.png" width="16px">
					<small>
						
						<a href="" class="dotted">code</a>
						
						<a href="" class="dotted">spritekit</a>
						
					</small>
				</div>
			</div>

			<div class="post source_light">				
 				<p>Memory leaks suck. You know they exist, and you dread the day you have to track them down. In SpriteKit, I&#8217;ve encountered two main types of leaks. One is where the entire scene is not deallocated after transitioning to a new scene. The other is where memory is constantly being used up while interacting with a scene. For the latter, you have to use Instruments in XCode, or comb over your code, to get a handle on what is happening. But, for cleaning up scenes after you&#8217;re finished with them, here are a few tips that simplified the process for me.
</p>

<h4 id="identify-the-leak">Identify The Leak</h4>

<p>Figuring out a leak exists is pretty easy. You can either watch the memory usage while navigating between scenes, or you can place this small snippet in your parent <code>GameScene : SKScene</code>:</p>

<pre><code>deinit {
    print(&quot;\n THIS SCENE WAS REMOVED FROM MEMORY (DEINIT) \n&quot;)
}
</code></pre>

<p>This will print a debug line if your scene is properly torn down. If you don&#8217;t see this line when transitioning to a new scene then you can assume your scene has a strong reference to it somewhere.</p>

<h4 id="fix-the-leak">Fix The Leak</h4>

<p>Now that you know you have a leak, here are a couple of tips on fixing it. First, you can start by cleaning up all nodes and actions when the scene is removed from view.</p>

<pre><code>override public func willMoveFromView(view: SKView) {
    self.removeAllChildren()
    self.removeAllActions()
}
</code></pre>

<p>I&#8217;ve seen this tip a few times across the web, and it seems like a safe practice. No performance issues yet, so it doesn&#8217;t hurt to have that catch all. But, more specifically, using <code>weak</code> references to <code>scene</code> and <code>self</code> are the true fix to removing strong references to scenes.</p>

<p>Let&#8217;s say you&#8217;re using a closure as a callback. Here is the proper way to set that:</p>

<pre><code>object.callback = { [weak self] in
    self?.doSomething()
}
</code></pre>

<p>Notice the <code>[weak self]</code> at the top, and the conditional <code>self?</code> in the code. Without that, a strong reference would have been created and the scene would have been retained. It&#8217;s important to note that this is an issue even if you aren&#8217;t using the <code>self</code> keyword. For example, take this function:</p>

<pre><code>func userTouchedSomething(scene:GameScene) {
    object.callback = { [weak scene] in
        scene?.doSomething()
    }
}
</code></pre>

<p>In the example above, scene was passed as a parameter to a function, and then used in the closure. We must use the <code>weak</code> reference in the exact same way.</p>

<p>Another variation of this issues can be seen with protocols and delegates. If you have a protocol, and set it as a <code>weak</code> delegate, you will see this error:</p>

<blockquote>
<p>weak cannot be applied to non-class type MyProtocol</p>
</blockquote>

<p>As seen in this <a href="http://stackoverflow.com/questions/24066304/how-can-i-make-a-weak-protocol-reference-in-pure-swift-w-o-objc" target="_blank">Stack Overflow answer</a>, we can fix this by adding <code>: class</code> to the protocol definition.</p>

<pre><code>public protocol MyProtocol : class {
    /// protocol code
}
</code></pre>

<h4 id="follow-up">Follow Up</h4>

<p>I&#8217;ll add to this if I come across anything specific. If you&#8217;re interested, you can also check out the <a href="https://github.com/veeneck/SwitchBoard" target="_blank">SwitchBoard</a> project that I am working on. The goal is to make scene management easy across all SpriteKit projects. It is not ready for primetime, but it does show you how to handle asset loading, caching, and scene transitions from one place.</p>
			</div>

		</article>

		<h2>Comments</h2>
			<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "battle-of-brothers" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	</div>
</div>

    
    <footer class="clear">

  	<div class="bob">
  		<img src="/assets/battleofbrothers.png" />
  	</div>

  	<div style="display:table;">
		<div class="footer_content">
		  	<div class="corner cell">
		  		<p>&nbsp</p>
	  			<img class="ryanfoot" src="/assets/RyanShieldLarge.png" />
	  		</div>
			<div class="about_contest cell">
				<div class="inner">
					<h5>$25,000. 2 brothers. 1 year. 0 experience.</h5>
					<p>Armed with little to no game development experience, we're setting out to see who can make the best game. 
					In the spirit of learning and following a passion, we're each going to take one year and a $25,000 budget to see how far we can get. 
					It begins on April 7th, 2014. We'll be documenting the journey.</p>
					<p><a href="/">Learn More!</a></p>
				</div>
			</div>
			<div class="links cell">
				<div class="outer">
					<h5>Sir Ryan</h5>
					<p>
					<a class="ryan" href="/sirryan/">Blog</a> /&nbsp; 
					<a class="ryan" href="/sirryan/budget">Budget</a> /&nbsp; 
					<a class="ryan" href="/sirryan/timeline">Timeline</a><span class="social">C</span>
					<a class="white" href="https://twitter.com/veeneck">@veeneck</a></br>
					<a class="ryan" href="/sirryan/contact">Contact</a> /&nbsp; 
					<a class="ryan" href="/sirryan/about">About</a> /&nbsp; 
					<a class="ryan" href="/category/sirryan">Archive</a>
					<span class="social rss">V</span><a class="white" href="http://feeds.feedburner.com/SirRyan">RSS Feed</a></br>
					</p>
					<h5>Sir Chris</h5>
					<p>
					<a class="chris" href="/sirchris/">Blog</a> /&nbsp; 
					<a class="chris" href="/sirchris/budget">Budget</a> /&nbsp; 
					<a class="chris" href="/sirchris/timeline">Timeline</a>
					<span class="social">C</span><a class="white" href="https://twitter.com/codepaladin">@codepaladin</a></br>
					<a class="chris" href="/sirchris/contact">Contact</a> /&nbsp; 
					<a class="chris" href="/sirchris/about">About</a> /&nbsp; 
					<a class="chris" href="/category/sirchris">Archive</a><span class="social rss">V</span>
					<a class="white" href="http://feeds.feedburner.com/SirChris">RSS Feed</a></br></p>
				</div>
			</div>
			<div class="corner cell">
				<p>&nbsp</p>
				<img class="chrisfoot" src="/assets/ChrisShieldLarge.png" />
			</div>
		</div>
	</div>
</footer>
  </body>
</html>