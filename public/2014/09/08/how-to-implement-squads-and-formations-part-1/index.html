

	


<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
	<title>Battle of Brothers | A Video Game Programming Duel</title>
	<meta name="description" content="Follow Chris and Ryan as they design indie video game software using the Corona SDK and Sprite Kit frameworks in this game programming duel.">
	<meta name="keywords" content=“video,game,programming,software, design, corona, sprite kit, indie”>
	<meta name="author" content="Battle of Brothers">
	<meta name="robots" content="index, follow">
	<meta name="viewport" content="width=1024"/>

  


   	 <link rel="stylesheet" href="/css/ryan.css?v=1'; ?>" type="text/css" media="screen" />
    <link rel="stylesheet" href="/css/global.css" type="text/css" media="screen" />





  <link rel="stylesheet" href="/css/post.css?v=1'; ?>" type="text/css" media="screen" />


  
</head>
  <body class="home gradient">

  	<div id="leftChecker"></div>

  	

<div class="top">
	<p class="breadcrumb">
		Currently following
		<a href="/sirryan" title="Hurrah!" class="dotted">Sir Ryan</a> 
		<a href="/sirchris" title="To see what the losing team is up to." class="switch floatright sirchris">See what Sir Chris is up to &#8611;</a>
	</p>
</div>



  	


	


<header class="content">
	<a class="ryanshield rotate " href="/sirryan">
		<img class="" style="" src="/assets/RyanShield.png" />
	</a>

	
	<a class="mainshield" href="/">
		<img alt="The one year game develpoment duel" src="/assets/Banner.png" width="266px" class="" />
	</a>
	

	<a class="chrisshield counterrotate" href="/sirchris">
		<img style="" src="/assets/ChrisShield.png" />
	</a>

</header> 

  	
<nav>
	<div class="container clear post">
  		<div class="leftnav clear">
  			<span>
	  			<a href="/sirryan" class="blog clear">
	  				<img class="" src="/assets/Castle.png" width="16px" />Sir Ryan
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/timeline" class="timeline clear">
	  				<img class="" src="/assets/Boom.png" width="16px"  />Timeline
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/budget" class="budget clear">
	  				<img class="" src="/assets/Money-5.png" width="16px"  />Budget
	  			</a>
  			</span>
		</div>
		<div class="rightnav clear">
			<span>
	  			<a href="/sirryan/contact" class="contact clear">
	  				<img class="" src="/assets/Game-Controller.png" width="16px"  />Contact
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/subscribe" class="subscribe clear">
	  				<img class="" src="/assets/RSS.png" width="16px"  />Subscribe
	  			</a>
  			</span>
			<span>
	  			<a href="/sirryan/about" class="about clear">
	  				<img class="" src="/assets/Pacman-2.png" width="16px"  />About
	  			</a>
  			</span>
		</div>
	</div>
</nav>


    

	<div class="outercontent">
  	  <div class="content clear">

		<article class="clear">
			<div class="title clear">
				<div class="floatleft">
					<span class="month legacy">Sep</span> 
					<p class="shield legacy" style="background-image:url('/assets/Shield10.png')">8</p>
					<span class="year legacy">2014</span> 
				</div>
				<h3 class="grace">How To Implement Squads and Formations, Part 1</h3>
				<div class="subhead">
					<span class="comments floatright">
						<img class="icon" src="/assets/Chat-6.png" width="16px" />
						<small><a href="/" class="dotted">X Comments</a></small>
					</span>
					<img class="icon" src="/assets/Tag-star.png" width="16px">
					<small>
						
						<a href="" class="dotted">code</a>
						
						<a href="" class="dotted">learning</a>
						
					</small>
				</div>
			</div>

			<div class="post source_light">				
 				<p>There is an awesome article on Gamasutra about <a href="http://www.gamasutra.com/view/feature/131720/coordinated_unit_movement.php?page=1" target="_blank">Coordinated Unit Movement</a>. They also have a companion post about <a href="http://www.gamasutra.com/view/feature/131721/implementing_coordinated_movement.php?page=1" target="_blank">implementing said movement</a>. However, the posts are from 1999, and they deal mainly in pseudocode. Also, I&#8217;m convinced there is absolutely nothing else on the entire internet explaining the topic. So, an experienced developer may be able to read the ideas and know how to implement them, but it has been a bit of a struggle for me as a new developer. I&#8217;m going to try to document a step by step implementation of formations, squads, and movement for someone who hasn&#8217;t done it before. I&#8217;ll be writing in Swift / Sprite Kit, but the code should be easy enough for anyone to follow. I also welcome corrections / improvements from experts.</p>

<p></p>

<h4 id="arrange-units-in-rows-and-columns">Arrange Units in Rows and Columns</h4>

<div class="inlineimg">
  <img class="alignnone size-large wp-image-1201" src="http://localhost:8888/wp-content/uploads/2014/09/Screen-Shot-2014-09-06-at-2.42.07-PM-1024x789.png" alt="Screen Shot 2014-09-06 at 2.42.07 PM" width="625" height="481" />
</div>

<p>Before reading anything, I started out by trying to make a Formation class that would be smart enough to handle any size or shape. Wrong approach. Instead, we&#8217;ll start with a <code>Squad</code> class that contains all of the units, and a <code>Formation</code> <a href="http://en.wikipedia.org/wiki/Strategy_pattern" target="_blank">strategy</a> that describes the layout of those units. It&#8217;s important to note that each arrangement (4&#215;3, 5&#215;2, wedge, etc) would be a new strategy, but for simplicity in this article I&#8217;m only going to use one class.</p>

<p>So, that&#8217;s the empty <code>Squad</code> container class. Here is the <code>Formation</code> class.</p>

<p><a href="https://gist.github.com/d7386c8f4752b64ef349">https://gist.github.com/d7386c8f4752b64ef349</a></p>

<p>Interestingly, a formation is just an array of vectors. Each vector is an offset from <code>0,0</code>, which is the center of our formation. I place the center row first in the array so that those spots are filled first. As of now, I&#8217;m matching the <code>units</code> array and the <code>positions</code> array.</p>

<p>The last step is to take the units and form them up into the appropriate positions. For that, we&#8217;ll add a <code>moveIntoFormation()</code> function to the <code>Squad</code> class.</p>

<p>And that&#8217;s it. With this code, we&#8217;ve recreated the screenshot at the top of this section.</p>

<h4 id="rotating-the-formation">Rotating the Formation</h4>

<div class="inlineimg">
  <img class="alignnone size-large wp-image-1212" src="http://localhost:8888/wp-content/uploads/2014/09/Screen-Shot-2014-09-06-at-3.21.27-PM-1-1024x789.png" alt="Screen Shot 2014-09-06 at 3.21.27 PM" width="625" height="481" />
</div>

<p>Next up, rotation. I won&#8217;t cover wheeling just yet, but the first step to wheeling is finding out what the final position should look like. This seems like it should be difficult. How can you rotate the vector <code>0,64</code> by 13 degrees and convert it to new coordinates? Well, thanks to a little bit of linear algebra and a lotta bit of internet help, we can apply a simple equation on each vector to adjust it to the new coordinate space. Here is what our new <code>moveIntoFormation()</code> function looks like.</p>

<p><a href="https://gist.github.com/e6d881884efdc7077c8b">https://gist.github.com/e6d881884efdc7077c8b</a></p>

<p>In particular, look at our <code>newX</code> and <code>newY</code> variables. They&#8217;ve been modified by a hard coded radian. We could easily make that a parameter in the function, and control the units rotation. And, to give credit where it&#8217;s due, I pulled the code from this <a href="http://stackoverflow.com/questions/22818531/how-to-rotate-2d-vector" target="_blank">Stack Overflow post</a>.</p>

<h4 id="improving-unit-8217-s-position-selection">Improving Unit&#8217;s Position Selection</h4>

<p>Up until now, each unit has been taking the vector that corresponds to their position in the <code>units</code> array. That causes people to overlap when they move into formation, as shown in the gif below.</p>

<div class="inlineimg">
  <img class="alignnone size-full wp-image-1218" src="http://localhost:8888/wp-content/uploads/2014/09/http___makeagif.com__media_9-08-2014_ag03kX-1.gif" alt="http___makeagif.com__media_9-08-2014_ag03kX" width="400" height="300" />
</div>

<p>This overlap looks a bit chunky, so let&#8217;s add some logic to the <code>moveIntoFormation()</code> function.</p>

<p>Two import changes to point out:</p>

<ul>
<li>We&#8217;re looping over a count now instead of the `units` array.</li>
<li>The unit that gets moved is now determined by `findClosestUnitToPosition()`</li>
</ul>

<p>Let&#8217;s have a look at our new function to determine the closest unit.</p>

<p><a href="https://gist.github.com/a87b942a30a74a6bbef4">https://gist.github.com/a87b942a30a74a6bbef4</a></p>

<p>With all of that applied, the gif below shows our new <code>moveIntoFormation()</code> code executing. Notice that the units walk in a smarter fashion now.</p>

<div class="inlineimg">
  <img class="alignnone wp-image-1226 size-full" src="http://localhost:8888/wp-content/uploads/2014/09/http___makeagif.com__media_9-08-2014_xyPv_m-1.gif" alt="" width="400" height="300" />
</div>

<p>&nbsp;</p>

<h4 id="further-polish">Further Polish</h4>

<p>We&#8217;ve got a lot of the core formation working, so all that is left is polish. Here are a few ideas:</p>

<ul>
<li>The `findClosestUnitToPosition()` function is just one of the many modifiers you could run. For example, if we wanted the healer to always be in the middle, we could make a function that moves him first, and then surrounds him. There are a ton of possibilities.</li>
<li>We could store a vector called `direction` on the `Formation` class. That way, units can face the correct direction once they reach their final position.</li>
<li>To take direction a step further, we could have an array of directional vectors. Each wall of the formation could face outwards instead of everyone facing the same direction.</li>
<li>When people assemble, place a random delay between each iteration of the loop. That way, it won&#8217;t look like *snap*, everyone moved. It&#8217;ll feel more natural.</li>
</ul>

<p>I&#8217;ve implemented a couple of those in the gif below. One note I would leave with is to be careful of doing too much at this step. For example, in my gif, one guy travels a bit too far to get to his spot. I could optimize that, but it would take more loops. I&#8217;d prefer to get everything acceptably functional, and then see what room is left for even more polish.</p>

<div class="inlineimg">
  <img class="alignnone size-full wp-image-1224" src="http://localhost:8888/wp-content/uploads/2014/09/http___makeagif.com__media_9-08-2014_7krXMl-1.gif" alt="http___makeagif.com__media_9-08-2014_7krXMl" width="400" height="300" />
</div>
			</div>

		</article>

	</div>
</div>

    
    <footer class="clear">

  	<div class="bob">
  		<img src="/assets/battleofbrothers.png" />
  	</div>

  	<div style="display:table;">
		<div class="footer_content">
		  	<div class="corner cell">
		  		<p>&nbsp</p>
	  			<img class="ryanfoot" src="/assets/RyanShieldLarge.png" />
	  		</div>
			<div class="about_contest cell">
				<div class="inner">
					<h5>$25,000. 2 brothers. 1 year. 0 experience.</h5>
					<p>Armed with little to no game development experience, we're setting out to see who can make the best game. 
					In the spirit of learning and following a passion, we're each going to take one year and a $25,000 budget to see how far we can get. 
					It begins on April 7th, 2014. We'll be documenting the journey.</p>
					<p><a href="/">Learn More!</a></p>
				</div>
			</div>
			<div class="links cell">
				<div class="outer">
					<h5>Sir Ryan</h5>
					<p>
					<a class="ryan" href="/sirryan/">Blog</a> /&nbsp; 
					<a class="ryan" href="/sirryan/budget">Budget</a> /&nbsp; 
					<a class="ryan" href="/sirryan/timeline">Timeline</a><span class="social">C</span>
					<a class="white" href="https://twitter.com/veeneck">@veeneck</a></br>
					<a class="ryan" href="/sirryan/contact">Contact</a> /&nbsp; 
					<a class="ryan" href="/sirryan/about">About</a> /&nbsp; 
					<a class="ryan" href="/category/sirryan">Archive</a>
					<span class="social rss">V</span><a class="white" href="http://feeds.feedburner.com/SirRyan">RSS Feed</a></br>
					</p>
					<h5>Sir Chris</h5>
					<p>
					<a class="chris" href="/sirchris/">Blog</a> /&nbsp; 
					<a class="chris" href="/sirchris/budget">Budget</a> /&nbsp; 
					<a class="chris" href="/sirchris/timeline">Timeline</a>
					<span class="social">C</span><a class="white" href="https://twitter.com/codepaladin">@codepaladin</a></br>
					<a class="chris" href="/sirchris/contact">Contact</a> /&nbsp; 
					<a class="chris" href="/sirchris/about">About</a> /&nbsp; 
					<a class="chris" href="/category/sirchris">Archive</a><span class="social rss">V</span>
					<a class="white" href="http://feeds.feedburner.com/SirChris">RSS Feed</a></br></p>
				</div>
			</div>
			<div class="corner cell">
				<p>&nbsp</p>
				<img class="chrisfoot" src="/assets/ChrisShieldLarge.png" />
			</div>
		</div>
	</div>
</footer>
  </body>
</html>