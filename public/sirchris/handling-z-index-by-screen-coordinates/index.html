


<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
	<title>Battle of Brothers | A Video Game Programming Duel</title>
	<meta name="description" content="Follow Chris and Ryan as they design indie video game software using the Corona SDK and Sprite Kit frameworks in this game programming duel.">
	<meta name="keywords" content=“video,game,programming,software, design, corona, sprite kit, indie”>
	<meta name="author" content="Battle of Brothers">
	<meta name="robots" content="index, follow">
	<meta name="viewport" content="width=1024"/>

  




   	 <link rel="stylesheet" href="/css/chris.css?v=1'; ?>" type="text/css" media="screen" />
    <link rel="stylesheet" href="/css/global.css" type="text/css" media="screen" />



  <link rel="stylesheet" href="/css/post.css?v=1'; ?>" type="text/css" media="screen" />


<script src="/js/index-min.js"></script>

  
</head>
  <body class="home gradient">

  	<div id="leftChecker"></div>

  	

<div class="top">
	<p class="breadcrumb">
		Currently following
		
		<a href="/sirchris" title="Hurrah!" class="dotted">Sir Chris</a> 
		<a href="/sirryan" title="To see what the losing team is up to." class="switch floatright sirchris">See what Sir Ryan is up to &#8611;</a>
		
	</p>
</div>



  	



<header class="content">
	<a class="ryanshield rotate " href="/sirryan">
		<img class="" style="" src="/assets/RyanShield.png" />
	</a>

	
	<a class="mainshield" href="/">
		<img alt="The one year game develpoment duel" src="/assets/Banner.png" width="266px" class="" />
	</a>
	

	<a class="chrisshield counterrotate" href="/sirchris">
		<img style="" src="/assets/ChrisShield.png" />
	</a>

</header> 

  	
<nav>
	
		<div class="container clear blog">
	
  		<div class="leftnav clear">
  			<span>
	  			<a href="/sirchris" class="blog clear">
	  				<img class="" src="/assets/Castle.png" width="16px" />Sir Ryan
	  			</a>
  			</span>
			<span>
	  			<a href="/sirchris/timeline" class="timeline clear">
	  				<img class="" src="/assets/Boom.png" width="16px"  />Timeline
	  			</a>
  			</span>
			<span>
	  			<a href="/sirchris/budget" class="budget clear">
	  				<img class="" src="/assets/Money-5.png" width="16px"  />Budget
	  			</a>
  			</span>
		</div>
		<div class="rightnav clear">
			<span>
	  			<a href="/sirchris/contact" class="contact clear">
	  				<img class="" src="/assets/Game-Controller.png" width="16px"  />Contact
	  			</a>
  			</span>
			<span>
	  			<a href="/sirchris/subscribe" class="subscribe clear">
	  				<img class="" src="/assets/RSS.png" width="16px"  />Subscribe
	  			</a>
  			</span>
			<span>
	  			<a href="/sirchris/about" class="about clear">
	  				<img class="" src="/assets/Pacman-2.png" width="16px"  />About
	  			</a>
  			</span>
		</div>
	</div>
</nav>


    <div class="outercontent">
  	  <div class="content clear">

		<article class="clear">
			<div class="title clear">
				
<div class="floatleft timestamp">
	<span class="month">Aug</span>
	<p class="shield" style="background-image:url('/assets/Shield8.png')">18</p>
	<span class="year legacy">2014</span>
</div>
				<h3 class="grace">Handling Z-Index by Screen Coordinates</h3>
				<div class="subhead">
					



	
	
		
	


<span class="comments floatright">
	<img class="icon" src="/assets/Chat-6.png" width="16px" />
	<small><a href="/sirchris/handling-z-index-by-screen-coordinates/#comments" class="dotted"><span></span>4 comments</a></small>
</span>
<img class="icon" src="/assets/Tag-star.png" width="16px">
<small>
	
	<a href="" class="dotted">code</a>
	
	<a href="" class="dotted">corona</a>
	
	<a href="" class="dotted">learning</a>
	
</small>
				</div>
			</div>

			

			
				
			
				
			
				
			

			<div class="post source_light">		
				
 				<p>One problem that I ran into with my game was that my characters and images were not being properly z-indexed. For example, the dwarf in the image below looks like he&#8217;s pasted on top of the tree, even though his position on the map suggests he should be behind the tree.
</p>

<div class="inlineimg">
  <img src="/wp-content/uploads/2014/08/zindex-incorrect-1.png" alt="zindex-incorrect" width="466" height="303" class="alignnone size-full wp-image-1003" srcset="/wp-content/uploads/2014/08/zindex-incorrect-1.png 466w, /wp-content/uploads/2014/08/zindex-incorrect-1-300x195.png 300w" sizes="(max-width: 466px) 100vw, 466px" />
</div>

<p>This is because in <a href="http://coronalabs.com/products/corona-sdk/">Corona</a>, objects are z-indexed in the order that they are originally drawn to the screen. The dwarf was originally drawn after the tree, so he will always appear to be in front of the tree, regardless if he&#8217;s supposed to be in front or behind the tree.</p>

<p>What I did to fix this is add a couple of functions that run on every frame, loop over all the images, and re-draw the images ordered by their y coordinates.</p>

<p><a href="https://gist.github.com/codepaladin/efa4c3b68ba5c110cdfa">https://gist.github.com/codepaladin/efa4c3b68ba5c110cdfa</a></p>

<p>What happens is that any image positioned further down on the y-axis should appear to be in front of any image that higher up on the y-axis. Since the tree has a lower y coordinate than the dwarf, the tree appears to be in front of the dwarf like this:</p>

<div class="inlineimg">
  <img src="/wp-content/uploads/2014/08/zindex-correct-1.png" alt="zindex-correct" width="466" height="303" class="alignnone size-full wp-image-1004" srcset="/wp-content/uploads/2014/08/zindex-correct-1.png 466w, /wp-content/uploads/2014/08/zindex-correct-1-300x195.png 300w" sizes="(max-width: 466px) 100vw, 466px" />
</div>

<p>Since the indexing functions runs on each frame, objects are correctly indexed as they move across the screen. The dwarf can move from behind the tree to in front of the tree and the objects will be drawn in the correct order to give the perception of depth.</p>
			</div>

		</article>

	</div>
</div>

<div class="outercontentalt">
  	<div class="content clear">

  		<div id="discuss" class="discuss">
			<img class="" src="/assets/discuss.png" />
		</div>

	  
	  
	  
	  	
	  	
		    <h5 class="grace comment-count"><span class="legacy">4</span> of you did not hold your tongue!</h5>
			<ol id="comments" class="commentlist">
		  		
		    		

		    			


<li >
	<div class="comment-body">
		<div class="comment-author vcard">
			<img src="https://www.gravatar.com/avatar/326b329e17bec94cfc3300bc2f567688?s=118&d=http://battleofbrothers.com/assets/comment_av_11.png" alt="" class="avatar avatar-64 photo" height="118" width="118">
		</div>
		<div class="comment-wrapper">
			
				<p>That&#39;s a great technique and I use Corona too, but haven&#39;t done this before myself. How does this work when it comes to using up the CPU since it has to reorganize so many objects?</p>
			
		</div>
		<div class="comment-meta commentmetadata">
			<a href="#">#</a> by 
			<cite class="fn">
				
				    Harry Tran
				
			</cite> Aug 23, 2014
		</div>
		<div class="reply">
			<a id="608" class="btn-info comment-reply-link" href="#comment-form" onclick="changeValue('fields[reply_to]', '608')">Reply</a>
		</div>
	</div>
</li>

<ul class="children">

  

  

  

  

</ul> 

		    		
		  		
		    		

		    			


<li >
	<div class="comment-body">
		<div class="comment-author vcard">
			<img src="https://www.gravatar.com/avatar/a7914e6231758ed5cdd4a8d31d9979a1?s=118&d=http://battleofbrothers.com/assets/comment_av_8.png" alt="" class="avatar avatar-64 photo" height="118" width="118">
		</div>
		<div class="comment-wrapper">
			
				<p>It&#39;s working for me so far, but I don&#39;t have a ton of objects on the screen. I have seen it slow down when I add some extra logic to the redrawing functions, though. I may end up not indexing the objects on every frame, but only when they really need to be indexed. For me, that means when characters are moving across the screen.</p>
			
		</div>
		<div class="comment-meta commentmetadata">
			<a href="#">#</a> by 
			<cite class="fn">
				
				    Chris
				
			</cite> Aug 25, 2014
		</div>
		<div class="reply">
			<a id="617" class="btn-info comment-reply-link" href="#comment-form" onclick="changeValue('fields[reply_to]', '617')">Reply</a>
		</div>
	</div>
</li>

<ul class="children">

  

  

  

  

</ul> 

		    		
		  		
		    		

		    			


<li >
	<div class="comment-body">
		<div class="comment-author vcard">
			<img src="https://www.gravatar.com/avatar/900fabef3d769338b0de476d456ce7b9?s=118&d=http://battleofbrothers.com/assets/comment_av_4.png" alt="" class="avatar avatar-64 photo" height="118" width="118">
		</div>
		<div class="comment-wrapper">
			
				<p><p>Chris,
First I would move your compare and table.sort functions &quot;outside&quot; of your enterFrame event and just call them once all the objects are loaded, calling these functions inside of your frame event is going to end up biting you in the butt :)
Without giving you to much of a leg up on your brother I would implement something like this.
function Reindex() for i = 1, #allImages do allImages[i]:toBack() end end
function FrameLoop() Reindex() end
function FinishedLoadingResources() local function compare( a, b ) return a.y &amp;gt; b.y end
table.sort(allImages, compare ) Runtime:addEventListener( &quot;enterFrame&quot;, FrameLoop ) end</p>

<p>Call FinishedLoadingResources after you have loaded up all your objects, the reason for the function is so you can put anything else you need in there like timers etc. and don&#39;t declare a local function inside of frame event :)
There are a lot of easier and faster ways to do this but if I wrote that code that would be cheating :)
Christopher</p>
</p>
			
		</div>
		<div class="comment-meta commentmetadata">
			<a href="#">#</a> by 
			<cite class="fn">
				
				    Christopher Bishop
				
			</cite> Aug 29, 2014
		</div>
		<div class="reply">
			<a id="623" class="btn-info comment-reply-link" href="#comment-form" onclick="changeValue('fields[reply_to]', '623')">Reply</a>
		</div>
	</div>
</li>

<ul class="children">

  

  

  

  

</ul> 

		    		
		  		
		    		

		    			


<li >
	<div class="comment-body">
		<div class="comment-author vcard">
			<img src="https://www.gravatar.com/avatar/2b1b8b274d4da7821241a784486953d2?s=118&d=http://battleofbrothers.com/assets/comment_av_10.png" alt="" class="avatar avatar-64 photo" height="118" width="118">
		</div>
		<div class="comment-wrapper">
			
				<p>Thanks, Christopher! That makes perfect sense. I&#39;m pretty sure you just gave me the edge I need to win this thing =)</p>
			
		</div>
		<div class="comment-meta commentmetadata">
			<a href="#">#</a> by 
			<cite class="fn">
				
				    Chris Campbell
				
			</cite> Aug 29, 2014
		</div>
		<div class="reply">
			<a id="644" class="btn-info comment-reply-link" href="#comment-form" onclick="changeValue('fields[reply_to]', '644')">Reply</a>
		</div>
	</div>
</li>

<ul class="children">

  

  

  

  

</ul> 

		    		
		  		     
		  	</ol>  
		 

		 <hr />
	  
 
	  <div class="comment-form">
  <div id="respond" class="comment-respond">
    <h3 id="reply-title" class="comment-reply-title">Speak Freely <small></h3>     

    <form class="comment-form" method="POST" action="https://api.staticman.net/v2/entry/veeneck/Battle-of-Brothers-Hugo/master/comments">
        <p class="comment-notes">
          <span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span>
        </p>
          <p class="comment-form-comment">
            <label for="comment">Comment</label> 
            <textarea id="comment" name="fields[body]" class="post-comment-field" placeholder="Your message. Feel free to use Markdown." cols="45" rows="8" maxlength="65525" required="required"></textarea>
          </p>
          <p class="comment-form-author">
            <label for="author">Name <span class="required">*</span></label> 
            <input id="author" name="fields[name]" type="text" class="post-comment-field" placeholder="Your name" required="required" size="30" maxlength="245">
          </p>
          <p class="comment-form-email">
            <label for="email">Email</label> 
            <input id="email" name="fields[email]" type="email" class="post-comment-field" placeholder="Your email address" ize="30" maxlength="100">
          </p>
          <p class="comment-form-url">
            <label for="website">Website</label> 
            <input id="website" name="fields[website]" type="url" class="post-comment-field" placeholder="http://yoursite.com" ize="30" maxlength="200">
          </p>
          <p class="form-submit">
            <input type="submit" id="submit" class="post-comment-field btn submit" value="Submit" id="submit_button" value="Post Comment">
            <input type="hidden" name="options[redirect]" value="http://battleofbrothers.com/sirchris/handling-z-index-by-screen-coordinates/#post-submitted">
            <input type="hidden" name="options[redirectError]" value="http://battleofbrothers.com/sirchris/handling-z-index-by-screen-coordinates/#post-error">
            <input type="hidden" name="options[entryId]" value="2014-08-18-handling-z-index-by-screen-coordinates">
            <input type="hidden" name="options[slug]" value="http://battleofbrothers.com/sirchris/handling-z-index-by-screen-coordinates/">
            <input type="hidden" name="options[origin]" value="http://battleofbrothers.com/sirchris/handling-z-index-by-screen-coordinates/">
            <input type="hidden" name="options[parent]" value="2014-08-18-handling-z-index-by-screen-coordinates">
            <input type="hidden" name="fields[reply_to]" value="">
          </p>      
      </form>
    </div>

    <div id="post-submitted">
      <hr style="margin-bottom: 50px;" />
      <h3 class="comment-reply-title">Thank you</h3>
        <p>Your comment will be published once it has been approved.</p>
        <p><a class="comment-reply-link" href="https://github.com/veeneck/Battle-of-Brothers-Hugo/pulls">Click here</a> to see the pull request you generated.</p>
    </div>
</div>
     </div>
</div> 

    
    <footer class="clear">

  	<div class="bob">
  		<img src="/assets/battleofbrothers.png" />
  	</div>

  	<div style="display:table;">
		<div class="footer_content">
		  	<div class="corner cell">
		  		<p>&nbsp</p>
	  			<img class="ryanfoot" src="/assets/RyanShieldLarge.png" />
	  		</div>
			<div class="about_contest cell">
				<div class="inner">
					<h5>$25,000. 2 brothers. 1 year. 0 experience.</h5>
					<p>Armed with little to no game development experience, we're setting out to see who can make the best game. 
					In the spirit of learning and following a passion, we're each going to take one year and a $25,000 budget to see how far we can get. 
					It begins on April 7th, 2014. We'll be documenting the journey.</p>
					<p><a href="/">Learn More!</a></p>
				</div>
			</div>
			<div class="links cell">
				<div class="outer">
					<h5>Sir Ryan</h5>
					<p>
					<a class="ryan" href="/sirryan/">Blog</a> /&nbsp; 
					<a class="ryan" href="/sirryan/budget">Budget</a> /&nbsp; 
					<a class="ryan" href="/sirryan/timeline">Timeline</a><span class="social">C</span>
					<a class="white" href="https://twitter.com/veeneck">@veeneck</a></br>
					<a class="ryan" href="/sirryan/contact">Contact</a> /&nbsp; 
					<a class="ryan" href="/sirryan/about">About</a> /&nbsp; 
					<a class="ryan" href="/category/sirryan">Archive</a>
					<span class="social rss">V</span><a class="white" href="http://feeds.feedburner.com/SirRyan">RSS Feed</a></br>
					</p>
					<h5>Sir Chris</h5>
					<p>
					<a class="chris" href="/sirchris/">Blog</a> /&nbsp; 
					<a class="chris" href="/sirchris/budget">Budget</a> /&nbsp; 
					<a class="chris" href="/sirchris/timeline">Timeline</a>
					<span class="social">C</span><a class="white" href="https://twitter.com/codepaladin">@codepaladin</a></br>
					<a class="chris" href="/sirchris/contact">Contact</a> /&nbsp; 
					<a class="chris" href="/sirchris/about">About</a> /&nbsp; 
					<a class="chris" href="/category/sirchris">Archive</a><span class="social rss">V</span>
					<a class="white" href="http://feeds.feedburner.com/SirChris">RSS Feed</a></br></p>
				</div>
			</div>
			<div class="corner cell">
				<p>&nbsp</p>
				<img class="chrisfoot" src="/assets/ChrisShieldLarge.png" />
			</div>
		</div>
	</div>
</footer>
  </body>
</html>